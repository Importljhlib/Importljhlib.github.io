name: Ruby Setup Workflow

on:
  push:
    branches:
      - main # main 브랜치에 변경이 푸시될 때 실행

jobs:
  setup-ruby:
    runs-on: ubuntu-latest # GitHub에서 제공하는 Ubuntu 환경 사용
    steps:
      - name: Checkout code
        uses: actions/checkout@v3 # 저장소 코드를 가져옴

      - name: Install ruby-build
        run: |
          git clone https://github.com/rbenv/ruby-build.git
          sudo PREFIX=/usr/local ./ruby-build/install.sh

      - name: Install Ruby 3.1.4
        run: |
          sudo ruby-build 3.1.4 /opt/hostedtoolcache/Ruby/3.1.4/x64
          sudo touch /opt/hostedtoolcache/Ruby/3.1.4/x64.complete

      - name: Verify Ruby installation
        run: |
          /opt/hostedtoolcache/Ruby/3.1.4/x64/bin/ruby --version
          
      - name: Install Bundler and dependencies
        run: |
          /opt/hostedtoolcache/Ruby/3.1.4/x64/bin/gem install bundler
          /opt/hostedtoolcache/Ruby/3.1.4/x64/bin/bundle install

